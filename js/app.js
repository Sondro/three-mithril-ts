!function o(a,s,u){function l(t,e){if(!s[t]){if(!a[t]){var r="function"==typeof require&&require;if(!e&&r)return r(t,!0);if(c)return c(t,!0);var n=new Error("Cannot find module '"+t+"'");throw n.code="MODULE_NOT_FOUND",n}var i=s[t]={exports:{}};a[t][0].call(i.exports,function(e){return l(a[t][1][e]||e)},i,i.exports,o,a,s,u)}return s[t].exports}for(var c="function"==typeof require&&require,e=0;e<u.length;e++)l(u[e]);return l}({1:[function(e,t,r){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(r,"__esModule",{value:!0});var o=n(e("three")),i=function(){function i(e,t,r,n){this.type=e,this.size=new o.Vector3(t,e!==i.SPHERE&&"number"==typeof r?r:t,e!==i.SPHERE&&"number"==typeof n?n:t)}return i.hit=function(e,t,r,n){return e.type===i.SPHERE&&r.type===i.SPHERE?t.distanceTo(n)<=e.size.x+r.size.x:e.type===i.AABB&&r.type===i.AABB?Math.abs(t.x-n.x)<(e.size.x+r.size.x)/2&&Math.abs(t.y-n.y)<(e.size.y+r.size.y)/2&&Math.abs(t.z-n.z)<(e.size.z+r.size.z)/2:e.type===i.SPHERE?a(t,n,r.size)<e.size.x:a(n,t,e.size)<r.size.x},i.create=function(e,t,r,n){return new i(e,t,r,n)},i.SPHERE=1,i.AABB=2,i}();function a(e,t,r){var n=s(e.x,t.x-r.x/2,t.x+r.x/2)+s(e.y,t.y-r.y/2,t.y+r.y/2)+s(e.z,t.z-r.z/2,t.z+r.z/2);return Math.sqrt(n)}function s(e,t,r){var n=e<t?t-e:r<e?e-r:0;return n*n}r.default=i},{three:"three"}],2:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(){this.eventCallbacks=Object.create(null)}return e.prototype.on=function(e,t){if(!e||"string"!=typeof e||"function"!=typeof t)throw new Error("Invalid params");var r=this.eventCallbacks[e];r?r.indexOf(t)<0&&r.push(t):(r=[t],this.eventCallbacks[e]=r)},e.prototype.off=function(e,t){if(!e||"string"!=typeof e||"function"!=typeof t)throw new Error("Invalid params");var r=this.eventCallbacks[e];if(r){var n=r.indexOf(t);n<0||(r.length<2?delete this.eventCallbacks[e]:r.splice(n,1))}},e.prototype.emit=function(e){if(!e.name||"string"!=typeof e.name)throw new Error("Invalid GameEvent");if(this.eventCallbacks[e.name])for(var t=0,r=this.eventCallbacks[e.name];t<r.length;t++){(0,r[t])(e)}},e}();r.default=n},{}],3:[function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var s=o(e("three")),u=a(e("./GameEventEmitter")),l=a(e("./Collider")),c=function(r){function a(e){void 0===e&&(e={});var t=r.call(this)||this;return t.visual=e.visual,t.collider=e.collider,t.position=e.position?e.position.clone():new s.Vector3,t.rotation=e.rotation?e.rotation.clone():new s.Euler,t.visual&&(t.visual.position.copy(t.position),t.visual.rotation.copy(t.rotation)),t.duration=e.duration,t.lifeT=0,t.isAlive=!0,e.onSnuff&&t.on("snuff",e.onSnuff),e.onKill&&t.on("kill",e.onKill),t}return i(a,r),a.updateList=function(e,t,r){for(var n=e.length-1;0<=n;--n)e[n].update(t)||(r&&r(e[n],n),e.splice(n,1))},a.renderList=function(e){for(var t=0;t<e.length;++t)e[t].render()},a.testHit=function(e,t){return!(!e.collider||!t.collider)&&l.default.hit(e.collider,e.position,t.collider,t.position)},a.testHitList=function(e,t,r){for(var n=0,i=t.length-1;0<=i;--i)if(a.testHit(e,t[i])&&(n+=1,r&&r(t[i])))return n;return n},a.testHitLists=function(e,t,r){for(var n=0,i=e.length-1;0<=i;--i)for(var o=t.length-1;0<=o&&!(a.testHit(e[i],t[o])&&(n+=1,r&&r(e[i],t[o])));--o);return n},a.prototype.update=function(e){return!!this.isAlive&&(this.lifeT+=e,!(null!=this.duration&&this.lifeT>=this.duration)||(this.snuff(),!1))},a.prototype.render=function(){this.visual&&(this.visual.position.copy(this.position),this.visual.rotation.copy(this.rotation))},a.prototype.snuff=function(){return!!this.isAlive&&(this.emit({name:"snuff",sender:this,position:this.position}),!(this.isAlive=!1))},a.prototype.kill=function(){return!!this.isAlive&&(this.emit({name:"kill",sender:this,position:this.position}),this.snuff(),!0)},a}(u.default);r.default=c},{"./Collider":1,"./GameEventEmitter":2,three:"three"}],4:[function(e,t,r){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(r,"__esModule",{value:!0});var a=n(e("three")),i=n(e("./config"));r.default=function(e,t,r){return new o(e,t,r)};var o=function(){function e(e,t,r){if(void 0===r&&(r={}),this.canvas=e,this.assets=t,this.assets.geometries.monkey.rotateX(.5*Math.PI),this.assets.geometries.bullet.scale(.5,.5,.5),this.assets.geometries.spark=new a.SphereBufferGeometry(.25,16,8),this.assets.textures.bricks.repeat.set(2,2),this.assets.textures.bricks.wrapS=this.assets.textures.bricks.wrapT=a.RepeatWrapping,this.materials={monkey:new a.MeshLambertMaterial({color:8943445}),building:new a.MeshLambertMaterial({color:16777215,map:this.assets.textures.bricks}),bullet:new a.MeshBasicMaterial({color:16737792}),spark:new a.MeshBasicMaterial({color:16763904,opacity:.75,transparent:!0})},this.renderer=new a.WebGLRenderer({canvas:e,antialias:!!r.antialias,clearColor:i.fogColor.getHex(),alpha:!0,clearAlpha:1}),!this.renderer)throw new Error("Failed to create THREE.WebGLRenderer");var n=e.getBoundingClientRect();this.displayWidth=n.width,this.displayHeight=n.height,this.camera=new a.PerspectiveCamera(i.fov,this.displayWidth/this.displayHeight,1,i.viewDepth),this.scene=new a.Scene,this.scene.fog=new a.Fog(i.fogColor.getHex(),i.fogNear,i.fogFar),this.sunLight=new a.DirectionalLight(i.lightColor.getHex(),1),this.sunLight.position.set(-i.lightDir.x,-i.lightDir.y,-i.lightDir.z),this.scene.add(this.sunLight),this.ambientLight=new a.AmbientLight(i.ambientColor.getHex()),this.scene.add(this.ambientLight),this.camera.rotation.order="ZXY",this.camera.rotation.x=.5*Math.PI,this.camera.rotation.y=.5*Math.PI,this.camera.rotation.z=Math.PI,this.camera.up.set(0,0,1),this.camHolder=new a.Object3D,this.camHolder.rotation.order="ZYX",this.camHolder.add(this.camera),this.camHolder.position.copy(i.playerStartPos),this.camHolder.rotation.x=i.playerStartRot.x,this.camHolder.rotation.y=i.playerStartRot.y,this.camHolder.rotation.z=i.playerStartRot.z,this.scene.add(this.camHolder),this.addGround()}return e.prototype.removeChild=function(e){this.scene.remove(e)},e.prototype.setCamera=function(e,t){e&&this.camHolder.position.copy(e),t&&(this.camHolder.rotation.x=t.x,this.camHolder.rotation.y=t.y,this.camHolder.rotation.z=t.z)},e.prototype.getCamera=function(){return this.camHolder},e.prototype.addGround=function(){var e=this.assets.textures.ground;e.wrapS=e.wrapT=a.RepeatWrapping,e.repeat.x=100,e.repeat.y=100;var t=new a.Mesh(new a.PlaneBufferGeometry(1e3,1e3),new a.MeshLambertMaterial({color:10066329,map:e}));this.scene.add(t)},e.prototype.addBuilding=function(e,t,r,n){var i=Math.max(Math.round(n/r),1),o=new a.Mesh(new a.BoxBufferGeometry(r,n,r,1,i,1).rotateX(.5*Math.PI),this.materials.building);return o.position.set(e,t,n/2),this.scene.add(o),o},e.prototype.addMonkey=function(e,t){var r=new a.Mesh(this.assets.geometries.monkey,this.materials.monkey);return r.position.copy(e),r.rotation.copy(t),this.scene.add(r),r},e.prototype.addBullet=function(e,t){var r=new a.Mesh(this.assets.geometries.bullet,this.materials.bullet);return r.position.copy(e),r.rotation.copy(t),this.scene.add(r),r},e.prototype.addSpark=function(e){var t=new a.Mesh(this.assets.geometries.spark,this.materials.spark.clone());return t.position.copy(e),this.scene.add(t),t},e.prototype.render=function(){this.renderer.render(this.scene,this.camera)},e.prototype.resize=function(e,t){this.displayWidth=e,this.displayHeight=t,this.canvas.width=e,this.canvas.height=t,this.renderer.setSize(e,t,!1),this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.renderer.render(this.scene,this.camera)},e.prototype.destroy=function(){this.renderer.dispose()},e}()},{"./config":5,three:"three"}],5:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("three");r.fov=60,r.viewDepth=2e3,r.fogColor=new n.Color(.4,.733,.8),r.fogNear=10,r.fogFar=200,r.lightDir=new n.Vector3(1,.5,-1).normalize(),r.lightColor=new n.Color(1,1,.95),r.ambientColor=new n.Color(.25,.25,.25),r.playerStartPos=new n.Vector3(0,0,2),r.playerStartRot=new n.Euler(0,0,-Math.PI/2),r.gridSize=10,r.buildingWidth=10,r.buildingMinHeight=6,r.buildingMaxHeight=20},{three:"three"}],6:[function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var a=o(e("../Collider")),s=function(r){function e(e){var t=r.call(this,e)||this;return t.collider=e.collider||a.default.create(a.default.AABB,e.width,e.width,e.height),t}return i(e,r),e.prototype.render=function(){},e}(o(e("../GameObject")).default);r.default=s},{"../Collider":1,"../GameObject":3}],7:[function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var s=o(e("three")),u=a(e("../Collider")),l=function(n){function e(e){var t=n.call(this,e)||this;t.duration=e.duration||1e3;var r=t.rotation.z;return t.velocity=new s.Vector3(e.absVel*Math.cos(r),e.absVel*Math.sin(r),0),t.collider=e.collider||u.default.create(u.default.SPHERE,.5),t}return i(e,n),e.prototype.update=function(e){if(!n.prototype.update.call(this,e))return!1;var t=e/1e3;return this.position.x+=t*this.velocity.x,this.position.y+=t*this.velocity.y,!0},e}(a(e("../GameObject")).default);r.default=l},{"../Collider":1,"../GameObject":3,three:"three"}],8:[function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var s=o(e("three")),u=a(e("../Collider")),l=function(r){function e(e){void 0===e&&(e={});var t=r.call(this,e)||this;return t.velocity=new s.Vector3,t.collider=e.collider||u.default.create(u.default.SPHERE,1),t}return i(e,r),e.prototype.update=function(e){if(!r.prototype.update.call(this,e))return!1;var t=e/1e3;return this.position.x+=t*this.velocity.x,this.position.y+=t*this.velocity.y,this.rotation.z+=t,!0},e}(a(e("../GameObject")).default);r.default=l},{"../Collider":1,"../GameObject":3,three:"three"}],9:[function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var s=o(e("three")),u=a(e("../Collider")),l=a(e("../GameObject")),c=Math.PI/2;function f(){return{forward:!1,back:!1,left:!1,right:!1,fire:!1}}r.PlayerInputs=f;var d=function(s){function e(e){var t=s.call(this,e)||this;return t.collider=e.collider||u.default.create(u.default.SPHERE,1.5),t.inputs={forward:!1,back:!1,left:!1,right:!1,fire:!1},t.fireT=0,t.on("shoot",e.onShoot),t}return i(e,s),e.prototype.on=function(e,t){return s.prototype.on.call(this,e,t)},e.prototype.emit=function(e){return s.prototype.emit.call(this,e)},e.prototype.setInputs=function(e){Object.assign(this.inputs,e)},e.prototype.update=function(e){s.prototype.update.call(this,e),this.fireT=Math.max(this.fireT-e,0);var t=e/1e3,r=this.inputs,n=r.forward?8*t:r.back?-.5*t*8:0,i=r.left?t*c:r.right?-t*c:0,o=this.rotation.z+i,a=this.position;return a.x+=n*Math.cos(o),a.y+=n*Math.sin(o),this.rotation.z+=i,r.fire&&this.fireT<=0&&(h.set(this.position.x,this.position.y,this.position.z-.5),this.emit({name:"shoot",sender:this,position:h,rotation:this.rotation}),this.fireT=333),!0},e}(l.default);r.default=d;var h=new s.Vector3},{"../Collider":1,"../GameObject":3,three:"three"}],10:[function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var a=function(r){function e(e){var t=r.call(this,e)||this;return t.duration=null!=e.duration?e.duration:500,t}return i(e,r),e.prototype.update=function(e){return!!r.prototype.update.call(this,e)},e.prototype.render=function(){r.prototype.render.call(this);var e=this.visual,t=1+3*this.lifeT/this.duration;e.scale.set(t,t,t),e.material.opacity=.75-.75*this.lifeT/this.duration},e}(o(e("../GameObject")).default);r.default=a},{"../GameObject":3}],11:[function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(r,"__esModule",{value:!0});var x=n(e("mithril/stream")),k=i(e("three")),S=i(e("./config")),j=i(e("../lib/input")),z=n(e("./GameScene")),P=n(e("./GameObject")),E=i(e("./gameobjects/Player")),H=n(e("./gameobjects/Monkey")),C=n(e("./gameobjects/Bullet")),L=n(e("./gameobjects/Building")),A=n(e("./gameobjects/Spark")),B=100;r.default=function(e,t){var o,s=z.default(e,t,{antialias:!0}),r=x.default(0),n=x.default(0),i=x.default(0),a=0,u=!1,l=E.PlayerInputs();j.createInput("forward",[38,87]),j.createInput("back",[40,83]),j.createInput("left",[37,65]),j.createInput("right",[39,68]),j.createInput("fire",[16,17,32]);var c=[],f=[],d=[],h=[];function p(e){var t=new C.default({visual:s.addBullet(e.position,e.rotation),position:e.position,rotation:e.rotation,onKill:m,absVel:30,duration:2e3});d.push(t)}function v(e){r(r()+100),h.push(new A.default({visual:s.addSpark(e.position),position:e.position,duration:500}))}function m(e){h.push(new A.default({visual:s.addSpark(e.position),position:e.position,duration:500}))}function y(){!function(){for(var e=new k.Vector3,t=new k.Euler,r=2*S.buildingWidth,n=0;n<S.gridSize;++n)for(var i=0;i<S.gridSize;++i){var o=S.buildingMinHeight+Math.random()*(S.buildingMaxHeight-S.buildingMinHeight);e.set((i-S.gridSize/2)*r+S.buildingWidth,(n-S.gridSize/2)*r+S.buildingWidth,o/2);var a=s.addBuilding(e.x,e.y,S.buildingWidth,o);f.push(new L.default({visual:a,position:e,rotation:t,width:S.buildingWidth,height:o}))}}()}function _(e){i(e),function(){for(var e=2*S.buildingWidth,t=new k.Vector3,r=new k.Euler,n=0;n<20;++n){t.set(Math.round(Math.random()*S.gridSize)*e-S.gridSize*e/2,Math.round(Math.random()*S.gridSize)*e-S.gridSize*e/2,2),r.z=Math.random()*Math.PI*2;var i=s.addMonkey(t,r);c.push(new H.default({visual:i,position:t,rotation:r,onKill:v}))}}(),o=new E.default({visual:s.getCamera(),position:S.playerStartPos,rotation:S.playerStartRot,onShoot:p})}function g(){if(u){var e=Date.now(),t=e-a;0<t&&(B<t&&(a+=t-B,t=B),r=t,n(n()+r),j.getKeys(l),null!=o&&(o.setInputs(l),o.update(r),P.default.testHitList(o,f,w)),P.default.updateList(c,r,O),P.default.updateList(d,r,O),P.default.updateList(h,r,O),P.default.testHitLists(d,c,M),P.default.testHitLists(d,f,b),null!=o&&o.render(),P.default.renderList(d),P.default.renderList(c),P.default.renderList(h),s.render()),a=e,requestAnimationFrame(g)}var r}function w(e){if(o){var t=e.collider.size.x/2+o.collider.size.x,r=e.position,n=o.position,i=Math.abs(n.x-r.x);return Math.abs(n.y-r.y)<i?n.x=n.x<r.x?r.x-t:r.x+t:n.y=n.y<r.y?r.y-t:r.y+t,!0}}function b(e,t){return e.kill(),!0}function M(e,t){return e.kill(),t.kill(),!0}function O(e){e.visual&&s.removeChild(e.visual)}return{run:function(){u?console.warn("Game already running"):(y(),_(1),u=!0,a=Date.now(),requestAnimationFrame(g))},resize:function(e,t){s&&s.resize(e,t)},destroy:function(){u=!1,s.destroy()},score:r,time:n,level:i}}},{"../lib/input":20,"./GameObject":3,"./GameScene":4,"./config":5,"./gameobjects/Building":6,"./gameobjects/Bullet":7,"./gameobjects/Monkey":8,"./gameobjects/Player":9,"./gameobjects/Spark":10,"mithril/stream":"mithril/stream",three:"three"}],12:[function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(r,"__esModule",{value:!0});var u=n(e("mithril")),l=n(e("mithril/stream")),c=i(e("../../config")),f=i(e("../../state")),d=e("../../lib/loader"),h=n(e("../../Game")),p=n(e("../TitleBlock")),v=n(e("../Hud"));r.default=function(){var n,i,r,o=l.default(),a=d.loadAssets({geometries:[{name:"monkey",url:"data/mesh/monkey.json"},{name:"bullet",url:"data/mesh/bullet.json"}],textures:[{name:"ground",url:"data/tex/ground.jpg"},{name:"bricks",url:"data/tex/bricks.jpg"}]},o),e=!1;function t(){i&&!e&&(i.run(),e=!0)}function s(){if(n){var e=n.getBoundingClientRect(),t=e.width,r=e.height;f.fontSize(c.defaultFontSize*r/c.defaultAppHeight),i&&i.resize(t,r),u.default.redraw()}}return{oncreate:function(e){var t=e.dom;n=t.querySelector("canvas.app-canvas"),window.addEventListener("resize",s),s(),a.then(function(e){setTimeout(function(){i=h.default(n,e),s()},100)}).catch(function(e){r=e,o.end(!0),u.default.redraw()})},onremove:function(){window.removeEventListener("resize",s),i&&(i.destroy(),n=i=void 0)},view:function(){return u.default(".app",u.default("canvas.app-canvas"),u.default(".ui",{style:"font-size: "+f.fontSize()+"px"},e?!!i&&u.default(v.default,{score:i.score,time:i.time,level:i.level}):u.default(p.default,{progress:o,ready:!!i,error:r,onStart:t})))}}}},{"../../Game":11,"../../config":18,"../../lib/loader":21,"../../state":24,"../Hud":13,"../TitleBlock":16,mithril:"mithril","mithril/stream":"mithril/stream"}],13:[function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(r,"__esModule",{value:!0});var o=n(e("mithril")),a=e("../../lib/string"),s=i(e("../../lib/fullscreen")),u=n(e("../Observer")),l=i(e("../svgs")),c={view:function(e){var t=e.attrs,r=t.score,n=t.time,i=t.level;return o.default(".hud",o.default(".score-block",o.default(u.default,{value:r,render:function(e){return String(e)},view:function(){return o.default(".score")}}),o.default(u.default,{value:n,render:function(e){return a.formatTime(e)},view:function(){return o.default(".time")}}),o.default(u.default,{value:i,render:function(e){return String(e)},view:function(){return o.default(".level")}})),o.default(".control-block",o.default(".fullscreen",o.default("button",{type:"button",onclick:function(){s.toggle(document.querySelector(".app"))}},s.is()?l.fullscreenOff():l.fullscreenOn()))))}};r.default=c},{"../../lib/fullscreen":19,"../../lib/string":22,"../Observer":15,"../svgs":17,mithril:"mithril"}],14:[function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var i=n(e("mithril")),o=n(e("../Observer")),a={view:function(e){var t=e.attrs.progress;return i.default(o.default,{value:t,render:function(e){return i.default(".bar",{style:"width: "+100*e+"%"})},view:function(){return i.default(".loading-bar")}})}};r.default=a},{"../Observer":15,mithril:"mithril"}],15:[function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var s=n(e("mithril")),i={value:void 0,oncreate:function(e){var t=e.dom,r=e.attrs,n=r.render,i=r.selector,o=r.value;this.value=o.map(function(e){return e});var a="string"==typeof i?t.querySelector(i):t;this.value.map(function(e){s.default.render(a,n(e))})},onremove:function(){this.value.end(!0)},view:function(e){return e.attrs.view(e)}};r.default=i},{mithril:"mithril"}],16:[function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var a=n(e("mithril")),s=n(e("../LoadingBar")),i={view:function(e){var t=e.attrs,r=t.progress,n=t.ready,i=t.error,o=t.onStart;return a.default(".title-block",a.default("h1","Monkey Hunt"),a.default("p","Use arrow keys or WASD to move"),a.default("p","Space, control or shift to fire."),n?a.default(".start-block",a.default("button.btn-start",{onclick:o},"Start")):a.default(".loading",a.default(".message",i?i.message:"Loading"),a.default("div",a.default(s.default,{progress:r}))))}};r.default=i},{"../LoadingBar":14,mithril:"mithril"}],17:[function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var i=n(e("mithril"));r.widescreenOn=function(){return i.default("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 67.733 67.733"},i.default("path",{d:"M0 12.7v42.333h67.733V12.7zm8.467 8.467h50.8v25.4h-50.8z"}))},r.widescreenOff=function(){return i.default("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 67.733 67.733"},i.default("path",{d:"M8.467 16.933V50.8h50.8V16.933zm8.466 8.467H50.8v16.933H16.933z"}))},r.fullscreenOn=function(){return i.default("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 469 469"},i.default("g",i.default("path",{d:"M455.5 0h-442C6 0 0 6 0 13.5v211.9c0 7.5 6 13.5 13.5 13.5s13.5-6 13.5-13.5V27h415v415H242.4c-7.5 0-13.5 6-13.5 13.5s6 13.5 13.5 13.5h213.1c7.5 0 13.5-6 13.5-13.5v-442C469 6 463 0 455.5 0z"}),i.default("path",{d:"M175.6 279.9H13.5c-7.5 0-13.5 6-13.5 13.5v162.1C0 463 6 469 13.5 469h162.1c7.5 0 13.5-6 13.5-13.5V293.4c0-7.4-6.1-13.5-13.5-13.5zM162.1 442H27V306.9h135.1V442zM360.4 127.7v71.5c0 7.5 6 13.5 13.5 13.5s13.5-6 13.5-13.5V95.1c0-7.5-6-13.5-13.5-13.5H269.8c-7.5 0-13.5 6-13.5 13.5s6 13.5 13.5 13.5h71.5L212.5 237.4c-5.3 5.3-5.3 13.8 0 19.1 2.6 2.6 6.1 4 9.5 4s6.9-1.3 9.5-4l128.9-128.8z"})))},r.fullscreenOff=function(){return i.default("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 469 469"},i.default("g",i.default("path",{d:"M455.5 0h-442C6 0 0 6 0 13.5v211.9c0 7.5 6 13.5 13.5 13.5s13.5-6 13.5-13.5V27h415v415H242.4c-7.5 0-13.5 6-13.5 13.5s6 13.5 13.5 13.5h213.1c7.5 0 13.5-6 13.5-13.5v-442C469 6 463 0 455.5 0z"}),i.default("path",{d:"M13.514 468.986h162.1c7.5 0 13.5-6 13.5-13.5v-162.1c0-7.5-6-13.5-13.5-13.5h-162.1c-7.5 0-13.5 6-13.5 13.5v162.1c0 7.4 6.1 13.5 13.5 13.5zm13.5-162.1h135.1v135.1h-135.1zm221.7-102.843v-71.5c0-7.5-6-13.5-13.5-13.5s-13.5 6-13.5 13.5v104.1c0 7.5 6 13.5 13.5 13.5h104.1c7.5 0 13.5-6 13.5-13.5s-6-13.5-13.5-13.5h-71.5l128.8-128.8c5.3-5.3 5.3-13.8 0-19.1-2.6-2.6-6.1-4-9.5-4-3.4 0-6.9 1.3-9.5 4z"})))}},{mithril:"mithril"}],18:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.defaultFontSize=15,r.defaultAppHeight=600,r.minAspect=1,r.maxAspect=2},{}],19:[function(e,t,r){"use strict";function n(){return!!(document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement)}Object.defineProperty(r,"__esModule",{value:!0}),r.toggle=function(e){n()?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()},r.is=n},{}],20:[function(e,t,u){"use strict";Object.defineProperty(u,"__esModule",{value:!0});var i=0,n=1,o=2,r=!!navigator.userAgent.match(/iPhone|iPad|iPod/i),s=Object.create(null);u.keyStates=new Array(256).fill(!1);var l=!1;function c(){l?console.warn("Key listeners already added."):(document.addEventListener("keydown",a,!0),document.addEventListener("keyup",f,!0),l=!0)}function a(e){var t=e.keyCode;if(!u.keyStates[t]){u.keyStates[t]=!0;for(var r=h(t),n=0;n<r.length;++n){var i=r[n];if(!i.pressed){i.pressed=!0;for(var o=i.listeners,a=0;a<o.length;++a){var s=o[a];"press"===s.type&&s.callback(i.name)}}}}}function f(e){var t=e.keyCode;if(u.keyStates[t]){u.keyStates[t]=!1;for(var r=h(t),n=0;n<r.length;++n){var i=r[n];if(i.pressed){if(p(i.name))return;if(v(i.name))return;i.pressed=!1;for(var o=i.listeners,a=0;a<o.length;++a){var s=o[a];"release"===s.type&&s.callback(i.name)}}}}}function d(e,t){for(var r=0;r<e.listeners.length;++r){var n=e.listeners[r];if(n.type===t)return n}}function h(e){for(var t=[],r=Object.keys(s),n=0;n<r.length;++n)for(var i=s[r[n]],o=i.keyCodes,a=0;a<o.length;++a)o[a]===e&&t.push(i);return t}function p(e){var t=s[e];if(t){for(var r=t.keyCodes,n=0;n<r.length;++n)if(u.keyStates[r[n]])return!0;return!1}console.warn("Unrecognized input name:",e)}function v(e){var t=s[e];if(t){for(var r=t.elements,n=0,i=r.length;n<i;++n)if(r[n].pressed)return!0;return!1}console.warn("Unrecognized input name:",e)}function m(e,t){var r=e.element;r.addEventListener("touchstart",function(){y(e,t,o)}),r.addEventListener("touchend",function(){_(e,t,o)}),r.addEventListener("mousedown",function(){y(e,t,n)}),r.addEventListener("mouseup",function(){_(e,t,n)}),r.addEventListener("touchmove",function(e){e.preventDefault()}),u.config.iOSHacks&&b(r)}function y(e,t,r){if((e.device===i||e.device===r)&&(e.device=r,e.pressed=!0,!t.pressed)){t.pressed=!0;var n=d(t,"press");n&&n.callback(t.name)}}function _(e,t,r){if((e.device===i||e.device===r)&&(e.pressed=!1,setTimeout(function(){e.device=i},500),t.pressed&&!p(name))){t.pressed=!1;var n=d(t,"release");n&&n.callback(t.name)}}function g(e){var t=s[e];return!!t&&t.pressed}u.addKeyListeners=c,u.removeKeyListeners=function(){l?(document.removeEventListener("keydown",a,!0),document.removeEventListener("keyup",f,!0),l=!1):console.warn("Key listeners were not yet added.")},u.listeningKeys=function(){return l},u.config={iOSHacks:!0},u.createInput=function(e,t,r){if(!e||"string"!=typeof e)throw new Error("Invalid name for input.");if(e in s)throw new Error("Input with name '"+e+" already exists.");var n={name:e,pressed:!1,keyCodes:[],elements:[],listeners:[]};if(t&&0<t.length){l||c();for(var i=0;i<t.length;++i){var o=t[i];0<=n.keyCodes.indexOf(o)&&console.warn("Duplicate key code ("+o+") specified for input '"+e+"'"),n.keyCodes[i]=o}}else if(!r||r.length<1)throw new Error("No keycodes or elements supplied to createInput");if(r&&0<r.length)for(i=0;i<r.length;++i){var a={element:r[i],pressed:!1,device:0};n.elements.push(a),m(a,n)}s[e]=n},u.get=g,u.getKeys=function(e){for(var t=Object.keys(e),r=0;r<t.length;++r){var n=t[r];e[n]=g(n)}return e},u.addListener=function(e,t,r){if(!e||"string"!=typeof e)throw new Error("Invalid type for name.");if("press"!==t&&"release"!==t)throw new Error("Invalid input event type.");var n=s[e];if(!n)throw new Error("Input with name '"+e+"' not found.");for(var i=n.listeners,o=0;o<i.length;++o){var a=i[o];if(a.type===t&&a.callback===r)return void console.warn("Already added this listener.")}i.push({type:t,callback:r})},u.removeListener=function(e,t,r){var n=s[e];n||console.warn("Input not found with name "+e);for(var i=n.listeners,o=i.length-1;0<=o;--o){var a=i[o];if(a.type===t&&a.callback===r)return void i.splice(o,1)}console.warn("Listener not found for input '"+e+"' with type "+t+", cannot remove.")};var w=["dblclick"];function b(t){r&&u.config.iOSHacks&&w.forEach(function(e){t.addEventListener(e,function(e){e.preventDefault()})})}u.snuffiOSEvents=b},{}],21:[function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(r,"__esModule",{value:!0});var o=n(e("mithril")),a=i(e("three")),c=n(e("pojod"));function f(e){return o.default.request({url:e,extract:function(e){return e.responseText},background:!0})}function d(e){return o.default.request({url:e,background:!0})}function h(n){return new Promise(function(e,t){var r=new Image;r.onload=function(){e(r)},r.onerror=function(e){t(e)},r.src=n})}function p(n){return new Promise(function(t,r){(new a.TextureLoader).load(n,function(e){t(e)},void 0,function(e){r(e.message?e:new Error("Failed to load texture: "+n))})})}function v(r){return new Promise(function(e,t){(new a.BufferGeometryLoader).load(r,e,void 0,function(e){t(new Error("Failed to load '"+r+"' ("+e.status+")"))})})}r.loadAssets=function(n,i){var o={texts:Object.create(null),datas:Object.create(null),images:Object.create(null),geometries:Object.create(null),textures:Object.create(null)},a={texts:f,datas:d,images:h,geometries:v,textures:p},e=c.default.keys(o),s=0,u=e.reduce(function(e,t){return n[t]&&(e+=n[t].length),e},0),l=0,t=e.reduce(function(e,r){return n[r]?e.concat(n[r].map(function(t){return a[r](t.url).then(function(e){return o[r][t.name]=e,s=(l+=1)/u,i&&i(s),e})})):e},[]);return Promise.all(t).then(function(){return o})}},{mithril:"mithril",pojod:"pojod",three:"three"}],22:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.formatTime=function(e){var t=Math.round(e/1e3),r=t%60;return Math.floor(t/60)+":"+(10<=r?"":"0")+r.toString()}},{}],23:[function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var i=n(e("mithril")),o=n(e("./components/App"));i.default.mount(document.querySelector(".game-container"),o.default)},{"./components/App":12,mithril:"mithril"}],24:[function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(r,"__esModule",{value:!0});var o=n(e("mithril/stream")),a=i(e("./config"));r.fontSize=o.default(a.defaultFontSize),r.pixelScale=r.fontSize.map(function(e){return e/a.defaultFontSize})},{"./config":18,"mithril/stream":"mithril/stream"}]},{},[23]);